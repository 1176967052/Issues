#### 分布式发号器
1. 分布式系统里，产生唯一流水号的服务器
   + 不用uuid的理由
     + 不具备时间粗略有序性，可反解和可制造性
     + 产生时使用完全的时间数据，性能比较差，uuid比较长，占用空间大，导致数据库性能下降
     + 不具备有序性
   + 不用数据库自增方案的理由
     + 完全依赖于数据库，在进行数据库移植，扩容，洗数据，分库分表等操作时会带来很多麻烦
   + 不用Twitter的Snowflake的理由
     + 发布模式单一，缺少支持和维护，很难在现实中直接使用

#### 分布式CAP定理
1. CAP定义
   1. Consistency (一致性)：即更新操作成功并返回客户端后，所有节点在同一时间的数据完全一致，这就是分布式的一致性。一致性的问题在并发系统中不可避免，对于客户端来说，一致性指的是并发访问时更新过的数据如何获取的问题。从服务端来看，则是更新如何复制分布到整个系统，以保证数据最终一致。
   2. Availability (可用性): 即服务一直可用，而且是正常响应时间。好的可用性主要是指系统能够很好的为用户服务，不出现用户操作失败或者访问超时等用户体验不好的情况。
   3. Partition Tolerance (分区容错性): 即分布式系统在遇到某节点或网络分区故障的时候，仍然能够对外提供满足一致性或可用性的服务。
2. CAP定理的证明
   
   两个应用服务各自对应一个数据库，A服务更新数据，B服务获取数据，A更新完后同步更新B，当AB网络故障，A更新完没有同步到B，程序有两个选择
   1. 牺牲数据一致性，响应旧的数据DB0给用户
   2. 牺牲可用性，阻塞等待，直到网络连接恢复，数据更新操作完成之后，再给用户响应最新的数据DB1
   
   说明了要满足分区容错性的分布式系统，只能在一致性和可用性两者中，选择其中一个。也就是说分布式系统不可能同时满足三个特性。
3. 取舍策略
   
   CA without P：如果不要求P（不允许分区），则C（强一致性）和A（可用性）是可以保证的。但放弃P的同时也就意味着放弃了系统的扩展性，也就是分布式节点受限，没办法部署子节点，这是违背分布式系统设计的初衷的。
   
   CP without A：如果不要求A（可用），相当于每个请求都需要在服务器之间保持强一致，而P（分区）会导致同步时间无限延长(也就是等待数据同步完才能正常访问服务)，一旦发生网络故障或者消息丢失等情况，就要牺牲用户的体验，等待所有数据全部一致了之后再让用户访问系统。设计成CP的系统其实不少，最典型的就是分布式数据库，如Redis、HBase等。对于这些分布式数据库来说，数据的一致性是最基本的要求，因为如果连这个标准都达不到，那么直接采用关系型数据库就好，没必要再浪费资源来部署分布式数据库。
   
   AP wihtout C：要高可用并允许分区，则需放弃一致性。一旦分区发生，节点之间可能会失去联系，为了高可用，每个节点只能用本地数据提供服务，而这样会导致全局数据的不一致性。典型的应用就如某米的抢购手机场景，可能前几秒你浏览商品的时候页面提示是有库存的，当你选择完商品准备下单的时候，系统提示你下单失败，商品已售完。这其实就是先在 A（可用性）方面保证系统可以正常的服务，然后在数据的一致性方面做了些牺牲，虽然多少会影响一些用户体验，但也不至于造成用户购物流程的严重阻塞。

4. Zookeeper 保证的是CP ，但对于服务发现而言，可用性比数据一致性更加重要 ，而 Eureka 设计则遵循AP原则 。
   
   ZooKeeper是分布式协调服务，它的职责是保证数据（注：配置数据，状态数据）在其管辖下的所有服务之间保持同步、一致；（强一致性）
    
   发现服务的核心应该是需要强调服务的高可用
   
   ZooKeeper使用单一主进程Leader用于处理客户端所有事务请求，采用ZAB协议将服务器数状态以事务形式广播到所有Follower上；如果三台服务挂了两台怎么选出leader；1 不大于 (3/2)=1的， 
                